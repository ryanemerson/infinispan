<project name="documentation" default="creatreport">

	<target name="copyfiles">
		<property name="src.dir" value="${basedir}/.." />
		<property name="work.dir" value="${project.build.directory}/generated/${infinispan.base.version}/report/tmp" />
		<property name="search.string" value="DescriptionDocumentation" />
		<delete dir="${work.dir}" />
		<mkdir dir="${work.dir}" />
		<copy todir="${work.dir}" failonerror="false" >
			<fileset dir="${src.dir}" defaultexcludes="true">
				<include name="**/*.xml" />
				<exclude name="**/descriptionreport.xml" />
				<contains text="${search.string}" casesensitive="yes" />
			</fileset>
		</copy>
	</target>
	<target name="creatreport" depends="copyfiles">
		<property name="temp.dir" value="${project.build.directory}/generated/${infinispan.base.version}/report/tmp" />
		<property name="dest.dir" value="${project.build.directory}/generated/${infinispan.base.version}/report" />
		<property name="xsl.prj" value="${basedir}" />
		<xslt style="${xsl.prj}/src/main/resources/Report.xsl" basedir="${work.dir}" destdir="${temp.dir}" extension=".html" includes="**/*.xml">
        </xslt>
		<concat append="true" destfile="${dest.dir}/Report.html">
			   <fileset dir="${temp.dir}" defaultexcludes="true">
	                <include name="**/*.html" />
	            </fileset>
		</concat>
		<delete dir="${temp.dir}"></delete>
	</target>
</project>
